{% extends 'users/base.html' %}
{% block content %}
<h1>Aqui ira el login principal</h1><hr>

<h4>Intento de hacer fetch al api</h4><hr>

<h2>Ãšltimas cargas de sal</h2>
<ul id="charge-list">
  <li>Cargando datos...</li>
</ul>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    fetch('http://127.0.0.1:8001/api/charges/')
      .then(response => {
        if (!response.ok) {
          throw new Error('Error en la respuesta del servidor');
        }
        return response.json();
      })
      .then(data => {
        const list = document.getElementById('charge-list');
        list.innerHTML = ''; // limpia el "Cargando..."

        if (data.length === 0) {
          list.innerHTML = '<li>No hay cargas registradas.</li>';
        } else {
          data.forEach(charge => {
            const item = document.createElement('li');
            item.textContent = `#${charge.id} | Inicio: ${charge.charge_time_start} | Entrada: ${charge.charge_weight_start} kg - ${charge.charge_humidity_start}% humedad`;
            list.appendChild(item);
          });
        }
      })
      .catch(error => {
        document.getElementById('charge-list').innerHTML = `<li>Error: ${error.message}</li>`;
        console.error('Error al obtener datos:', error);
      });
  });
</script>


{% endblock %}